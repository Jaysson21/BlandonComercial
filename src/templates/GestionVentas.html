{% extends 'layout.html'%}
{% block body %}
<link rel="stylesheet" href="{{url_for('static', filename='css/GestionVentas.css')}}">

<div class="container mt-4">
    <!-- Panel de Navegación con Pestañas -->
    <ul class="nav nav-tabs" id="gestionVentasTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="nueva-venta-tab" data-bs-toggle="tab" data-bs-target="#nueva-venta"
                type="button" role="tab" aria-controls="nueva-venta" aria-selected="true">Nueva Venta</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="ventas-pendientes-tab" data-bs-toggle="tab" data-bs-target="#ventas-pendientes"
                type="button" role="tab" aria-controls="ventas-pendientes" aria-selected="false">Ventas
                Pendientes</button>
        </li>
    </ul>

    <!-- Contenido de las Pestañas -->
    <div class="tab-content" id="gestionVentasTabContent">
        <!-- Panel Nueva Venta (contenido original) -->
        <div class="tab-pane fade show active" id="nueva-venta" role="tabpanel" aria-labelledby="nueva-venta-tab">
            <!-- Contenido original de la vista de nueva venta -->
            {% include 'partials/nueva_venta.html' %}
        </div>

        <!-- Panel Ventas Pendientes -->
        <div class="tab-pane fade" id="ventas-pendientes" role="tabpanel" aria-labelledby="ventas-pendientes-tab">
            <div class="card mt-4">
                <div class="card-header">Ventas Pendientes de Entrega</div>
                <div class="card-body">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Cliente</th>
                                <th>Fecha de Venta</th>
                                <th>Monto Total</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="ventasPendientesTableBody">
                            <!-- Las filas de ventas pendientes se generarán dinámicamente con JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Función para cargar ventas pendientes (puede ser una función AJAX para obtener datos del servidor)
    function cargarVentasPendientes() {
        // Ejemplo de datos de ventas pendientes (esto debería venir de una solicitud AJAX en la vida real)
        const ventasPendientes = [
            { cliente: "Juan Pérez", fecha: "2024-11-05", monto: 1500.00 },
            { cliente: "Ana Gómez", fecha: "2024-11-04", monto: 2300.00 }
        ];

        // Seleccionar el cuerpo de la tabla
        const tableBody = document.getElementById("ventasPendientesTableBody");
        tableBody.innerHTML = ""; // Limpiar el contenido

        ventasPendientes.forEach(venta => {
            const row = document.createElement("tr");
            row.innerHTML = `
                <td>${venta.cliente}</td>
                <td>${venta.fecha}</td>
                <td>C$ ${venta.monto.toFixed(2)}</td>
                <td><button class="btn btn-success btn-sm" onclick="entregarVenta('${venta.cliente}')">Entregar</button></td>
            `;
            tableBody.appendChild(row);
        });
    }

    // Función para marcar una venta como entregada
    function entregarVenta(cliente) {
        Swal.fire({
            title: `¿Confirmas la entrega para ${cliente}?`,
            icon: 'question',
            showCancelButton: true,
            confirmButtonText: 'Sí, entregar',
            cancelButtonText: 'Cancelar'
        }).then((result) => {
            if (result.isConfirmed) {
                // Aquí puedes llamar a una función para actualizar el estado de la venta a "Entregada"
                Swal.fire('Entregado!', `La venta de ${cliente} ha sido marcada como entregada.`, 'success');
            }
        });
    }

    // Cargar ventas pendientes cuando se carga la pestaña correspondiente
    document.getElementById('ventas-pendientes-tab').addEventListener('shown.bs.tab', cargarVentasPendientes);
</script>
<script src="{{url_for('static', filename='js/GestionVentas.js')}}"></script>
{% endblock %}